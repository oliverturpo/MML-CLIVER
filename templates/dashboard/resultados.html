{% extends 'dashboard/base_dashboard.html' %}

{% block page_title %}Resultados{% endblock %}
{% block page_subtitle %}An√°lisis y visualizaci√≥n de m√©tricas del modelo{% endblock %}

{% block content %}
<!-- Model Performance Overview -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
    <!-- Main Performance Card -->
    <div class="lg:col-span-2 bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-2xl p-8 relative overflow-hidden">
        <div class="absolute top-0 right-0 opacity-20">
            <i class="fas fa-chart-line text-8xl transform rotate-12"></i>
        </div>
        <div class="relative z-10">
            <h2 class="text-3xl font-bold mb-4">Rendimiento del Modelo</h2>
            <p class="text-white/90 text-lg mb-6">
                {% if perfil.tiene_modelo_entrenado %}
                    Tu modelo {{ perfil.get_algoritmo_elegido_display }} ha sido entrenado exitosamente.
                {% else %}
                    Entrena tu modelo para ver los resultados aqu√≠.
                {% endif %}
            </p>
            {% if not perfil.tiene_modelo_entrenado %}
                <a href="{% url 'dashboard_modelo' perfil.id %}" class="bg-white/20 text-white px-6 py-2 rounded-lg hover:bg-white/30 transition-colors">
                    <i class="fas fa-play mr-2"></i>Entrenar Modelo
                </a>
            {% endif %}
        </div>
    </div>

    <!-- Model Status -->
    <div class="space-y-4">
        <div class="bg-white rounded-xl p-6 shadow-lg">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-600 text-sm">Estado del Modelo</p>
                    <p class="text-lg font-semibold text-gray-800">
                        {% if perfil.tiene_modelo_entrenado %}
                            <span class="text-green-600">Entrenado</span>
                        {% else %}
                            <span class="text-orange-600">Pendiente</span>
                        {% endif %}
                    </p>
                </div>
                <div class="w-16 h-16 rounded-full flex items-center justify-center
                    {% if perfil.tiene_modelo_entrenado %}bg-gradient-to-r from-green-400 to-green-500{% else %}bg-gradient-to-r from-orange-400 to-orange-500{% endif %}">
                    <i class="fas {% if perfil.tiene_modelo_entrenado %}fa-check{% else %}fa-clock{% endif %} text-white text-xl"></i>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl p-6 shadow-lg">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-600 text-sm">Tiempo Entrenamiento</p>
                    <p class="text-lg font-semibold text-gray-800">
                        {{ perfil.tiempo_entrenamiento|default:"--:--" }}
                    </p>
                </div>
                <div class="w-16 h-16 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-full flex items-center justify-center">
                    <i class="fas fa-stopwatch text-white text-xl"></i>
                </div>
            </div>
        </div>
    </div>
</div>

{% if perfil.metricas %}
<!-- PROYECTO PUNO - Informaci√≥n destacada -->
<div class="bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-600 rounded-xl p-6 mb-8 shadow-lg">
    <div class="flex items-center mb-4">
        <i class="fas fa-project-diagram text-green-600 text-2xl mr-3"></i>
        <h3 class="text-xl font-bold text-green-800">PROYECTO PARCIAL - Predicci√≥n de Pobreza en Puno</h3>
    </div>

    <div class="grid md:grid-cols-3 gap-4 mb-4">
        <div class="bg-white rounded-lg p-4 border-l-4 border-blue-500">
            <p class="text-sm text-gray-600 mb-2">Algoritmo utilizado:</p>
            <p class="text-lg font-bold text-blue-900">{{ perfil.get_algoritmo_elegido_display }}</p>
        </div>
        <div class="bg-white rounded-lg p-4 border-l-4 border-purple-500">
            <p class="text-sm text-gray-600 mb-2">Datos de entrenamiento:</p>
            <p class="text-lg font-bold text-purple-900">{{ perfil.metricas.Train_Size|default:"--" }} familias</p>
        </div>
        <div class="bg-white rounded-lg p-4 border-l-4 border-orange-500">
            <p class="text-sm text-gray-600 mb-2">Datos de prueba:</p>
            <p class="text-lg font-bold text-orange-900">{{ perfil.metricas.Test_Size|default:"--" }} familias</p>
        </div>
    </div>

    <!-- Validaci√≥n Cruzada y Hiperpar√°metros -->
    {% if perfil.metricas.CV_Mean_Score %}
    <div class="bg-white rounded-lg p-4 mb-4">
        <h4 class="font-bold text-gray-800 mb-3 flex items-center">
            <i class="fas fa-sync-alt text-blue-500 mr-2"></i>
            Validaci√≥n Cruzada (5-Fold CV)
        </h4>
        <div class="grid md:grid-cols-2 gap-4">
            <div>
                <p class="text-sm text-gray-600">Score Promedio CV:</p>
                <p class="text-2xl font-bold text-blue-600">{{ perfil.metricas.CV_Mean_Score|floatformat:4 }} ¬± {{ perfil.metricas.CV_Std_Score|floatformat:4 }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-600">Mejor Score (Hiperpar√°metros):</p>
                <p class="text-2xl font-bold text-green-600">{{ perfil.metricas.Best_CV_Score|floatformat:4 }}</p>
            </div>
        </div>
    </div>
    {% endif %}

    {% if perfil.metricas.Best_Params %}
    <div class="bg-white rounded-lg p-4">
        <h4 class="font-bold text-gray-800 mb-2 flex items-center">
            <i class="fas fa-sliders-h text-purple-500 mr-2"></i>
            Mejores Hiperpar√°metros
        </h4>
        <div class="flex flex-wrap gap-2">
            {% for param, value in perfil.metricas.Best_Params.items %}
            <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">
                {{ param }}: {{ value }}
            </span>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<!-- Advertencia sobre m√©tricas bajas -->
{% if perfil.metricas.Recall and perfil.metricas.Recall < 0.5 %}
<div class="bg-yellow-50 border-l-4 border-yellow-500 rounded-xl p-6 mb-8">
    <div class="flex items-start">
        <i class="fas fa-exclamation-triangle text-yellow-600 text-2xl mr-4 mt-1"></i>
        <div>
            <h3 class="text-lg font-bold text-yellow-800 mb-2">‚ö†Ô∏è Advertencia: Recall Bajo ({{ perfil.metricas.Recall|floatformat:4 }})</h3>
            <p class="text-yellow-900 mb-3">
                El modelo tiene <strong>baja sensibilidad</strong> para detectar familias en pobreza.
                Esto significa que est√° fallando en identificar muchas familias que realmente est√°n en situaci√≥n de pobreza.
            </p>
            <div class="bg-white rounded-lg p-4 mb-3">
                <p class="text-sm font-semibold text-gray-800 mb-2">¬øPor qu√© ocurre esto?</p>
                <ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">
                    <li><strong>Desbalanceo de clases:</strong> Hay menos familias en pobreza en el dataset</li>
                    <li><strong>Caracter√≠sticas limitadas:</strong> Las variables disponibles no capturan todas las dimensiones de pobreza</li>
                    <li><strong>Umbral de decisi√≥n:</strong> El modelo es conservador al clasificar como "en pobreza"</li>
                </ul>
            </div>
            <div class="bg-white rounded-lg p-4">
                <p class="text-sm font-semibold text-gray-800 mb-2">üí° Sugerencias de mejora:</p>
                <ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">
                    <li>Aplicar <strong>t√©cnicas de balanceo</strong> (SMOTE, class_weight)</li>
                    <li>Recopilar m√°s datos de familias en situaci√≥n de pobreza</li>
                    <li>Ajustar el <strong>threshold de clasificaci√≥n</strong> para priorizar recall</li>
                    <li>Considerar <strong>modelos ensemble</strong> (Random Forest, XGBoost)</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- M√©tricas Principales con Interpretaciones -->
<div class="bg-white rounded-2xl p-6 shadow-lg mb-8">
    <h3 class="text-xl font-bold mb-6 flex items-center">
        <i class="fas fa-chart-bar mr-3 text-indigo-500"></i>
        M√©tricas de Rendimiento del Modelo
    </h3>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Accuracy -->
        {% if perfil.metricas.Accuracy %}
        <div class="border-2 border-gray-100 rounded-xl p-4 hover:border-blue-300 transition-all">
            <div class="flex items-center justify-between mb-2">
                <h4 class="text-sm font-semibold text-gray-600 uppercase">Accuracy</h4>
                <i class="fas fa-bullseye text-blue-500"></i>
            </div>
            <p class="text-3xl font-bold text-gray-800 mb-2">{{ perfil.metricas.Accuracy|floatformat:4 }}</p>
            <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                {% widthratio perfil.metricas.Accuracy 1 100 as acc_percent %}
                <div class="bg-gradient-to-r from-blue-400 to-blue-600 h-2 rounded-full" style="width: {{ acc_percent }}%"></div>
            </div>
            <p class="text-xs text-gray-600">Clasifica correctamente {{ acc_percent }}% de las familias</p>
        </div>
        {% endif %}

        <!-- Precision -->
        {% if perfil.metricas.Precision %}
        <div class="border-2 border-gray-100 rounded-xl p-4 hover:border-green-300 transition-all">
            <div class="flex items-center justify-between mb-2">
                <h4 class="text-sm font-semibold text-gray-600 uppercase">Precision</h4>
                <i class="fas fa-crosshairs text-green-500"></i>
            </div>
            <p class="text-3xl font-bold text-gray-800 mb-2">{{ perfil.metricas.Precision|floatformat:4 }}</p>
            <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                {% widthratio perfil.metricas.Precision 1 100 as prec_percent %}
                <div class="bg-gradient-to-r from-green-400 to-green-600 h-2 rounded-full" style="width: {{ prec_percent }}%"></div>
            </div>
            <p class="text-xs text-gray-600">{{ prec_percent }}% de las predicciones "en pobreza" son correctas</p>
        </div>
        {% endif %}

        <!-- Recall -->
        {% if perfil.metricas.Recall %}
        <div class="border-2 {% if perfil.metricas.Recall < 0.5 %}border-yellow-300 bg-yellow-50{% else %}border-gray-100{% endif %} rounded-xl p-4 hover:border-orange-300 transition-all">
            <div class="flex items-center justify-between mb-2">
                <h4 class="text-sm font-semibold text-gray-600 uppercase">Recall</h4>
                <i class="fas fa-search text-orange-500"></i>
            </div>
            <p class="text-3xl font-bold {% if perfil.metricas.Recall < 0.5 %}text-yellow-700{% else %}text-gray-800{% endif %} mb-2">
                {{ perfil.metricas.Recall|floatformat:4 }}
            </p>
            <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                {% widthratio perfil.metricas.Recall 1 100 as recall_percent %}
                <div class="bg-gradient-to-r from-orange-400 to-orange-600 h-2 rounded-full" style="width: {{ recall_percent }}%"></div>
            </div>
            <p class="text-xs text-gray-600">
                Detecta {{ recall_percent }}% de las familias que realmente est√°n en pobreza
                {% if perfil.metricas.Recall < 0.5 %}‚ö†Ô∏è{% endif %}
            </p>
        </div>
        {% endif %}

        <!-- F1-Score -->
        {% if perfil.metricas.F1_Score %}
        <div class="border-2 border-gray-100 rounded-xl p-4 hover:border-purple-300 transition-all">
            <div class="flex items-center justify-between mb-2">
                <h4 class="text-sm font-semibold text-gray-600 uppercase">F1-Score</h4>
                <i class="fas fa-balance-scale text-purple-500"></i>
            </div>
            <p class="text-3xl font-bold text-gray-800 mb-2">{{ perfil.metricas.F1_Score|floatformat:4 }}</p>
            <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                {% widthratio perfil.metricas.F1_Score 1 100 as f1_percent %}
                <div class="bg-gradient-to-r from-purple-400 to-purple-600 h-2 rounded-full" style="width: {{ f1_percent }}%"></div>
            </div>
            <p class="text-xs text-gray-600">Balance entre precisi√≥n y recall</p>
        </div>
        {% endif %}

        <!-- ROC-AUC -->
        {% if perfil.metricas.AUC %}
        <div class="border-2 border-gray-100 rounded-xl p-4 hover:border-indigo-300 transition-all">
            <div class="flex items-center justify-between mb-2">
                <h4 class="text-sm font-semibold text-gray-600 uppercase">ROC-AUC</h4>
                <i class="fas fa-chart-area text-indigo-500"></i>
            </div>
            <p class="text-3xl font-bold text-gray-800 mb-2">{{ perfil.metricas.AUC|floatformat:4 }}</p>
            <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                {% widthratio perfil.metricas.AUC 1 100 as auc_percent %}
                <div class="bg-gradient-to-r from-indigo-400 to-indigo-600 h-2 rounded-full" style="width: {{ auc_percent }}%"></div>
            </div>
            <p class="text-xs text-gray-600">Capacidad de discriminar entre clases</p>
        </div>
        {% endif %}
    </div>

    <!-- Explicaci√≥n contextual -->
    <div class="mt-6 bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4">
        <p class="text-sm text-blue-900">
            <i class="fas fa-info-circle mr-2"></i>
            <strong>Interpretaci√≥n para Puno:</strong> En un proyecto social, el <strong>Recall</strong> es cr√≠tico porque
            queremos detectar el m√°ximo n√∫mero de familias en pobreza para brindarles apoyo.
            {% if perfil.metricas.Recall < 0.5 %}
            Con un recall de {{ perfil.metricas.Recall|floatformat:2 }}, el modelo est√° fallando en identificar
            a la mayor√≠a de las familias que realmente necesitan ayuda.
            {% else %}
            Un recall de {{ perfil.metricas.Recall|floatformat:2 }} indica que estamos detectando una buena proporci√≥n
            de familias en situaci√≥n de pobreza.
            {% endif %}
        </p>
    </div>
</div>

<!-- Matriz de Confusi√≥n - Tabla Interpretada -->
{% if perfil.metricas.Confusion_Matrix %}
<div class="bg-white rounded-2xl p-6 shadow-lg mb-8">
    <h3 class="text-xl font-bold mb-6 flex items-center">
        <i class="fas fa-table mr-3 text-blue-500"></i>
        Matriz de Confusi√≥n - Interpretaci√≥n
    </h3>

    {% with cm=perfil.metricas.Confusion_Matrix %}
    <!-- Tabla cruzada de confusi√≥n -->
    <div class="overflow-x-auto mb-6">
        <table class="w-full border-collapse">
            <thead>
                <tr>
                    <th class="border-2 border-gray-300 bg-gray-100 p-4" rowspan="2" colspan="2">
                        <div class="text-center text-gray-600 font-bold">Total: {{ cm.0.0|add:cm.0.1|add:cm.1.0|add:cm.1.1 }} familias</div>
                    </th>
                    <th class="border-2 border-gray-300 bg-indigo-100 p-3 text-center font-bold text-indigo-900" colspan="2">
                        <i class="fas fa-robot mr-2"></i>PREDICCI√ìN DEL MODELO
                    </th>
                </tr>
                <tr>
                    <th class="border-2 border-gray-300 bg-blue-50 p-3 text-center font-semibold text-blue-900">
                        NO en Pobreza
                    </th>
                    <th class="border-2 border-gray-300 bg-red-50 p-3 text-center font-semibold text-red-900">
                        S√ç en Pobreza
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="border-2 border-gray-300 bg-green-100 p-3 text-center font-bold text-green-900 align-middle" rowspan="2">
                        <div class="transform -rotate-180" style="writing-mode: vertical-lr;">
                            <i class="fas fa-clipboard-check"></i> REALIDAD
                        </div>
                    </td>
                    <td class="border-2 border-gray-300 bg-blue-50 p-3 text-center font-semibold text-blue-900">
                        NO en Pobreza
                    </td>
                    <td class="border-2 border-gray-300 bg-green-100 p-4 text-center">
                        <div class="text-3xl font-bold text-green-700">{{ cm.0.0 }}</div>
                        <div class="text-xs text-green-600 mt-1">‚úì Verdaderos Negativos (VN)</div>
                        <div class="text-xs text-gray-600 mt-2">Familias NO pobres<br>correctamente identificadas</div>
                    </td>
                    <td class="border-2 border-gray-300 bg-red-100 p-4 text-center">
                        <div class="text-3xl font-bold text-red-700">{{ cm.0.1 }}</div>
                        <div class="text-xs text-red-600 mt-1">‚úó Falsos Positivos (FP)</div>
                        <div class="text-xs text-gray-600 mt-2">Familias NO pobres<br>clasificadas como pobres</div>
                    </td>
                </tr>
                <tr>
                    <td class="border-2 border-gray-300 bg-red-50 p-3 text-center font-semibold text-red-900">
                        S√ç en Pobreza
                    </td>
                    <td class="border-2 border-gray-300 bg-yellow-100 p-4 text-center">
                        <div class="text-3xl font-bold text-yellow-700">{{ cm.1.0 }}</div>
                        <div class="text-xs text-yellow-600 mt-1">‚úó Falsos Negativos (FN)</div>
                        <div class="text-xs text-gray-600 mt-2">Familias pobres<br>NO detectadas ‚ö†Ô∏è</div>
                    </td>
                    <td class="border-2 border-gray-300 bg-green-100 p-4 text-center">
                        <div class="text-3xl font-bold text-green-700">{{ cm.1.1 }}</div>
                        <div class="text-xs text-green-600 mt-1">‚úì Verdaderos Positivos (VP)</div>
                        <div class="text-xs text-gray-600 mt-2">Familias pobres<br>correctamente identificadas</div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Interpretaci√≥n para Puno -->
    <div class="grid md:grid-cols-2 gap-4">
        <div class="bg-green-50 border-l-4 border-green-500 rounded-lg p-4">
            <h4 class="font-bold text-green-800 mb-2 flex items-center">
                <i class="fas fa-check-circle mr-2"></i>Clasificaciones Correctas
            </h4>
            <div class="space-y-2 text-sm text-green-900">
                <p><strong>VN ({{ cm.0.0 }}):</strong> Familias sin pobreza identificadas correctamente</p>
                <p><strong>VP ({{ cm.1.1 }}):</strong> Familias en pobreza identificadas correctamente</p>
                <p class="text-green-700 font-semibold mt-3">
                    Total correcto: {{ cm.0.0|add:cm.1.1 }} familias ({{ perfil.metricas.Accuracy|floatformat:2 }}%)
                </p>
            </div>
        </div>

        <div class="bg-red-50 border-l-4 border-red-500 rounded-lg p-4">
            <h4 class="font-bold text-red-800 mb-2 flex items-center">
                <i class="fas fa-exclamation-triangle mr-2"></i>Errores del Modelo
            </h4>
            <div class="space-y-2 text-sm text-red-900">
                <p><strong>FP ({{ cm.0.1 }}):</strong> Familias clasificadas como pobres sin serlo (gasto innecesario)</p>
                <p><strong>FN ({{ cm.1.0 }}):</strong> Familias pobres NO detectadas ‚ö†Ô∏è (problema cr√≠tico)</p>
                <p class="text-red-700 font-semibold mt-3">
                    Total errores: {{ cm.0.1|add:cm.1.0 }} familias ({{ cm.0.1|add:cm.1.0|floatformat:0 }} casos)
                </p>
            </div>
        </div>
    </div>

    <!-- Impacto social -->
    <div class="mt-4 bg-yellow-50 border-l-4 border-yellow-500 rounded-lg p-4">
        <p class="text-sm text-yellow-900">
            <i class="fas fa-exclamation-circle mr-2"></i>
            <strong>Impacto Social:</strong> De las {{ cm.1.0|add:cm.1.1 }} familias que realmente est√°n en pobreza,
            el modelo solo detect√≥ {{ cm.1.1 }} familias.
            Esto significa que <strong>{{ cm.1.0 }} familias pobres NO recibir√≠an ayuda</strong> con este modelo.
        </p>
    </div>
    {% endwith %}
</div>
{% endif %}

<!-- Curva de Validaci√≥n Cruzada - Interpretada -->
{% if perfil.metricas.CV_Mean_Score %}
<div class="bg-white rounded-2xl p-6 shadow-lg mb-8">
    <h3 class="text-xl font-bold mb-6 flex items-center">
        <i class="fas fa-chart-line mr-3 text-purple-500"></i>
        Validaci√≥n Cruzada (5-Fold) - Consistencia del Modelo
    </h3>

    <div class="grid md:grid-cols-3 gap-6 mb-6">
        <div class="bg-purple-50 border-2 border-purple-200 rounded-xl p-6 text-center">
            <div class="text-4xl font-bold text-purple-600 mb-2">
                {{ perfil.metricas.CV_Mean_Score|floatformat:4 }}
            </div>
            <div class="text-sm text-purple-900 font-semibold">Score Promedio (5 folds)</div>
            <div class="text-xs text-gray-600 mt-2">Rendimiento consistente del modelo</div>
        </div>

        <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-6 text-center">
            <div class="text-4xl font-bold text-blue-600 mb-2">
                ¬± {{ perfil.metricas.CV_Std_Score|floatformat:4 }}
            </div>
            <div class="text-sm text-blue-900 font-semibold">Desviaci√≥n Est√°ndar</div>
            <div class="text-xs text-gray-600 mt-2">Variabilidad entre folds</div>
        </div>

        <div class="bg-green-50 border-2 border-green-200 rounded-xl p-6 text-center">
            <div class="text-4xl font-bold text-green-600 mb-2">
                {{ perfil.metricas.Best_CV_Score|floatformat:4 }}
            </div>
            <div class="text-sm text-green-900 font-semibold">Mejor Score (ajustado)</div>
            <div class="text-xs text-gray-600 mt-2">Con hiperpar√°metros √≥ptimos</div>
        </div>
    </div>

    <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4">
        <h4 class="font-bold text-blue-800 mb-3 flex items-center">
            <i class="fas fa-info-circle mr-2"></i>¬øQu√© significa la Validaci√≥n Cruzada?
        </h4>
        <div class="space-y-2 text-sm text-blue-900">
            <p>‚úì El dataset se dividi√≥ en <strong>5 partes (folds)</strong></p>
            <p>‚úì El modelo se entren√≥ <strong>5 veces</strong>, cada vez usando 4 partes para entrenar y 1 para validar</p>
            <p>‚úì Score promedio: <strong>{{ perfil.metricas.CV_Mean_Score|floatformat:2 }}</strong> - rendimiento t√≠pico esperado</p>
            <p>‚úì Desviaci√≥n baja ({{ perfil.metricas.CV_Std_Score|floatformat:4 }}) indica que el modelo es <strong>consistente</strong></p>
            <p class="text-blue-700 font-semibold mt-3">
                <i class="fas fa-check-circle mr-1"></i>
                Conclusi√≥n: El modelo tiene un rendimiento {% if perfil.metricas.CV_Std_Score < 0.05 %}muy consistente{% elif perfil.metricas.CV_Std_Score < 0.1 %}consistente{% else %}variable{% endif %}
                entre diferentes subconjuntos de datos.
            </p>
        </div>
    </div>
</div>
{% endif %}

<!-- Feature Importance -->
<div class="bg-white rounded-2xl p-6 shadow-lg mb-8">
    <h3 class="text-xl font-bold mb-6 flex items-center">
        <i class="fas fa-weight-hanging mr-3 text-purple-500"></i>
        Importancia de Caracter√≠sticas
    </h3>
    <div class="h-80">
        <canvas id="featureImportance"></canvas>
    </div>
</div>

<!-- ROC Curve and Precision-Recall -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <div class="bg-white rounded-2xl p-6 shadow-lg">
        <h3 class="text-xl font-bold mb-6 flex items-center">
            <i class="fas fa-crosshairs mr-3 text-red-500"></i>
            Curva ROC
        </h3>
        <div class="h-80">
            <canvas id="rocCurve"></canvas>
        </div>
    </div>

    <div class="bg-white rounded-2xl p-6 shadow-lg">
        <h3 class="text-xl font-bold mb-6 flex items-center">
            <i class="fas fa-bullseye mr-3 text-orange-500"></i>
            Precisi√≥n vs Recall
        </h3>
        <div class="h-80">
            <canvas id="precisionRecall"></canvas>
        </div>
    </div>
</div>
{% else %}
<!-- No Results State -->
<div class="bg-white rounded-2xl p-12 shadow-lg text-center">
    <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
        <i class="fas fa-chart-line text-4xl text-gray-400"></i>
    </div>
    <h3 class="text-2xl font-bold text-gray-800 mb-4">No hay resultados disponibles</h3>
    <p class="text-gray-600 mb-8 max-w-md mx-auto">
        Para ver m√©tricas y visualizaciones, primero necesitas entrenar tu modelo con un dataset.
    </p>

    <div class="flex flex-col sm:flex-row gap-4 justify-center">
        {% if not perfil.dataset_nombre %}
            <a href="{% url 'dashboard_datos' perfil.id %}" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors">
                <i class="fas fa-upload mr-2"></i>Subir Dataset
            </a>
        {% endif %}

        {% if perfil.dataset_nombre and not perfil.algoritmo_elegido %}
            <a href="{% url 'dashboard_modelo' perfil.id %}" class="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors">
                <i class="fas fa-robot mr-2"></i>Configurar Modelo
            </a>
        {% endif %}

        {% if perfil.dataset_nombre and perfil.algoritmo_elegido %}
            <a href="{% url 'dashboard_modelo' perfil.id %}" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors">
                <i class="fas fa-play mr-2"></i>Entrenar Modelo
            </a>
        {% endif %}
    </div>
</div>
{% endif %}

<!-- Export and Actions -->
<div class="bg-white rounded-2xl p-6 shadow-lg">
    <h3 class="text-xl font-bold mb-6 flex items-center">
        <i class="fas fa-download mr-3 text-indigo-500"></i>
        Exportar Resultados
    </h3>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <button class="flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all group">
            <div class="text-center">
                <i class="fas fa-file-pdf text-2xl text-gray-400 group-hover:text-blue-500 mb-2"></i>
                <p class="font-medium text-gray-600 group-hover:text-blue-700">Reporte PDF</p>
            </div>
        </button>

        <button class="flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-all group">
            <div class="text-center">
                <i class="fas fa-file-excel text-2xl text-gray-400 group-hover:text-green-500 mb-2"></i>
                <p class="font-medium text-gray-600 group-hover:text-green-700">Datos Excel</p>
            </div>
        </button>

        <button class="flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all group">
            <div class="text-center">
                <i class="fas fa-code text-2xl text-gray-400 group-hover:text-purple-500 mb-2"></i>
                <p class="font-medium text-gray-600 group-hover:text-purple-700">C√≥digo Python</p>
            </div>
        </button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    {% if perfil.metricas %}
    // Feature Importance Chart
    const featureCtx = document.getElementById('featureImportance');
    if (featureCtx) {
        {% if perfil.metricas.Feature_Importance %}
        const featureData = {{ perfil.metricas.Feature_Importance|safe }};

        new Chart(featureCtx, {
            type: 'bar',
            data: {
                labels: featureData.features,
                datasets: [{
                    label: 'Importancia',
                    data: featureData.importances,
                    backgroundColor: 'rgba(147, 51, 234, 0.8)',
                    borderColor: 'rgb(147, 51, 234)',
                    borderWidth: 2
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    title: {
                        display: true,
                        text: 'Importancia de Caracter√≠sticas del Modelo'
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Importancia'
                        }
                    }
                }
            }
        });
        {% elif perfil.metricas.Feature_Coefficients %}
        const coeffData = {{ perfil.metricas.Feature_Coefficients|safe }};

        new Chart(featureCtx, {
            type: 'bar',
            data: {
                labels: coeffData.features,
                datasets: [{
                    label: 'Coeficiente',
                    data: coeffData.coefficients,
                    backgroundColor: coeffData.coefficients.map(c => c >= 0 ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)'),
                    borderColor: coeffData.coefficients.map(c => c >= 0 ? 'rgb(34, 197, 94)' : 'rgb(239, 68, 68)'),
                    borderWidth: 2
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    title: {
                        display: true,
                        text: 'Coeficientes del Modelo'
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Valor del Coeficiente'
                        }
                    }
                }
            }
        });
        {% else %}
        featureCtx.parentElement.innerHTML = '<div class="flex items-center justify-center h-full text-gray-400"><p>No disponible para este modelo</p></div>';
        {% endif %}
    }

    // ROC Curve
    const rocCtx = document.getElementById('rocCurve');
    if (rocCtx) {
        {% if perfil.metricas.ROC_FPR and perfil.metricas.ROC_TPR %}
        const rocFpr = {{ perfil.metricas.ROC_FPR|safe }};
        const rocTpr = {{ perfil.metricas.ROC_TPR|safe }};
        const rocAuc = {{ perfil.metricas.AUC|default:0 }};

        new Chart(rocCtx, {
            type: 'line',
            data: {
                labels: rocFpr,
                datasets: [{
                    label: `ROC Curve (AUC = ${rocAuc.toFixed(3)})`,
                    data: rocTpr,
                    borderColor: 'rgb(249, 115, 22)',
                    backgroundColor: 'rgba(249, 115, 22, 0.1)',
                    tension: 0.1,
                    fill: true,
                    pointRadius: 0
                }, {
                    label: 'L√≠nea Base',
                    data: rocFpr.map(x => x),
                    borderColor: 'rgb(75, 85, 99)',
                    borderDash: [5, 5],
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Curva ROC - Receiver Operating Characteristic'
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Tasa de Falsos Positivos (FPR)'
                        },
                        min: 0,
                        max: 1
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Tasa de Verdaderos Positivos (TPR)'
                        },
                        min: 0,
                        max: 1
                    }
                }
            }
        });
        {% else %}
        rocCtx.parentElement.innerHTML = '<div class="flex items-center justify-center h-full text-gray-400"><p>No disponible para este modelo</p></div>';
        {% endif %}
    }

    // Precision-Recall Curve
    const prCtx = document.getElementById('precisionRecall');
    if (prCtx) {
        new Chart(prCtx, {
            type: 'line',
            data: {
                labels: [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0],
                datasets: [{
                    label: 'Precisi√≥n vs Recall',
                    data: [1.0, 0.95, 0.92, 0.88, 0.85, 0.80, 0.75, 0.68, 0.60, 0.50, 0.40],
                    borderColor: 'rgb(249, 115, 22)',
                    backgroundColor: 'rgba(249, 115, 22, 0.1)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Recall'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Precisi√≥n'
                        }
                    }
                }
            }
        });
    }
    {% endif %}

    // Export functionality
    document.querySelectorAll('button[class*="group"]').forEach(button => {
        button.addEventListener('click', function() {
            const text = this.querySelector('p').textContent;
            console.log(`Exportando: ${text}`);
            // Implement export logic here
        });
    });
});
</script>
{% endblock %}